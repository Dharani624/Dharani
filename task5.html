<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shoply — Single-Page Demo</title>

  <!-- Critical (inline) CSS for fast first paint -->
  <style>
    :root{
      --accent:#0066ff; --muted:#666; --bg:#f6f7fb; --card:#fff; --radius:12px;
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#0b1220;line-height:1.4}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}

    /* Header */
    header.site-header{background:linear-gradient(90deg,var(--accent),#0046d6);color:#fff;padding:14px 0}
    .site-header .wrap{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{font-weight:700;margin:0}
    .brand a{color:inherit;text-decoration:none}
    .controls{display:flex;gap:10px;align-items:center}
    .icon-btn{background:transparent;border:0;color:inherit;cursor:pointer;font-weight:600}

    /* Hero */
    .hero{display:grid;gap:12px;align-items:center;margin:22px 0}
    .hero .cta{display:inline-block;padding:10px 14px;background:#fff;color:var(--accent);border-radius:10px;text-decoration:none;font-weight:600}

    /* Filters */
    .filters{display:flex;gap:10px;flex-wrap:wrap;margin:18px 0}
    .filters select,.filters input{padding:8px;border-radius:8px;border:1px solid #e3e6ee}

    /* Products */
    .product-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .product{background:var(--card);padding:12px;border-radius:var(--radius);box-shadow:0 8px 24px rgba(10,12,20,0.06);display:flex;flex-direction:column}
    .product img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    .product h3{margin:10px 0 6px;font-size:1.05rem}
    .meta{color:var(--muted);font-size:0.95rem}
    .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:8px}
    .btn{background:var(--accent);color:#fff;border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
    .btn.secondary{background:#eef3ff;color:var(--accent)}

    /* Cart drawer */
    .cart-drawer{position:fixed;right:18px;top:80px;width:380px;max-width:90vw;background:var(--card);border-radius:12px;box-shadow:0 20px 40px rgba(10,12,20,0.12);padding:12px;transform:translateY(-10px);opacity:0;pointer-events:none;transition:opacity .22s,transform .22s}
    .cart-drawer.open{opacity:1;pointer-events:auto;transform:translateY(0)}
    .cart-list{list-style:none;padding:0;margin:0;max-height:320px;overflow:auto}
    .cart-item{display:flex;gap:10px;align-items:center;padding:8px;border-bottom:1px solid #f0f2f6}
    .cart-item img{width:56px;height:46px;object-fit:cover;border-radius:8px}
    .cart-summary{margin-top:10px;padding-top:8px;border-top:1px dashed #eee}

    /* Modal (product quick view) */
    .modal-backdrop{position:fixed;inset:0;background:rgba(8,10,16,0.45);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .18s}
    .modal-backdrop.open{opacity:1;pointer-events:auto}
    .modal{background:var(--card);width:min(880px,95vw);border-radius:12px;padding:16px;box-shadow:0 40px 80px rgba(10,12,20,0.18);display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .modal img{width:100%;height:300px;object-fit:cover;border-radius:8px}
    .modal h3{margin-top:0}

    /* Responsive */
    @media(max-width:900px){.product-grid{grid-template-columns:repeat(2,1fr)}.modal{grid-template-columns:1fr}}
    @media(max-width:600px){.site-header .wrap{flex-direction:column;align-items:flex-start} .product-grid{grid-template-columns:1fr} .cart-drawer{position:fixed;left:50%;transform:translate(-50%,0);right:auto;top:auto;bottom:18px;width:92vw}}

    /* Small utilities */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <h1 class="brand"><a href="#">Shoply</a></h1>
      <div class="controls">
        <label class="sr-only" for="search">Search</label>
        <input id="search" placeholder="Search products..." aria-label="Search products" />

        <select id="category">
          <option value="all">All categories</option>
          <option value="electronics">Electronics</option>
          <option value="clothing">Clothing</option>
        </select>

        <select id="sort">
          <option value="none">Sort</option>
          <option value="low">Price: Low → High</option>
          <option value="high">Price: High → Low</option>
        </select>

        <button id="openCart" class="icon-btn" aria-haspopup="dialog" aria-expanded="false">Cart (<span id="cartCount">0</span>)</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h2>Responsive & Performant Single-Page E‑commerce Demo</h2>
      <p class="muted">Products, quick-view modal, cart with localStorage, filtering, sorting, and lazy images.</p>
    </section>

    <section id="products" class="product-grid" aria-live="polite" aria-label="Product results"></section>
  </main>

  <!-- Cart drawer -->
  <aside id="cartDrawer" class="cart-drawer" role="region" aria-label="Shopping cart">
    <h3>Your cart</h3>
    <ul id="cartList" class="cart-list"></ul>
    <div class="cart-summary">
      <div id="cartTotal">Total: $0.00</div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="checkoutBtn" class="btn">Checkout</button>
        <button id="clearCart" class="btn secondary">Clear</button>
      </div>
    </div>
  </aside>

  <!-- Modal (product quick view) -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <div>
        <img id="modalImg" src="" alt="">
      </div>
      <div>
        <h3 id="modalTitle"></h3>
        <p id="modalDesc" class="muted"></p>
        <p><strong id="modalPrice"></strong></p>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="modalAdd" class="btn">Add to cart</button>
          <button id="modalClose" class="btn secondary">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  // Single-file app.js (small, efficient, no external fetch)
  (()=>{
    'use strict';

    // Sample product data (inlined for single-file demo) — replace with API in real app
    const PRODUCTS = [
      {id:1,name:'Smartphone X',category:'electronics',price:599,desc:'A fast smartphone with great camera.',image:'iphone.jpg'},
      {id:2,name:'Wireless Headphones',category:'electronics',price:129,desc:'Comfortable, long battery life.',image:'wireless.jpg'},
      {id:3,name:'Laptop Pro',category:'electronics',price:1299,desc:'Powerful laptop for creators.',image:'laptop.jpg'},
      {id:4,name:'Classic T-Shirt',category:'clothing',price:25,desc:'Soft cotton, great fit.',image:'t shirt.jpg'},
      {id:5,name:'Jeans Relaxed',category:'clothing',price:49,desc:'Stylish and comfortable.',image:'jeans.jpg'},
      {id:6,name:'Sneakers',category:'clothing',price:89,desc:'Everyday sneakers with grip.',image:'sneakers.jpg'}
    ];

    // LocalStorage key
    const CART_KEY = 'shoply_cart_v1';

    // DOM refs
    const productGrid = document.getElementById('products');
    const categorySel = document.getElementById('category');
    const sortSel = document.getElementById('sort');
    const searchInput = document.getElementById('search');
    const cartCount = document.getElementById('cartCount');
    const cartDrawer = document.getElementById('cartDrawer');
    const cartList = document.getElementById('cartList');
    const cartTotal = document.getElementById('cartTotal');
    const openCartBtn = document.getElementById('openCart');
    const clearCartBtn = document.getElementById('clearCart');
    const checkoutBtn = document.getElementById('checkoutBtn');

    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalImg = document.getElementById('modalImg');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalPrice = document.getElementById('modalPrice');
    const modalAdd = document.getElementById('modalAdd');
    const modalClose = document.getElementById('modalClose');

    // Utility: load/save cart
    function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY))||[] }catch(e){return[]} }
    function saveCart(cart){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); renderCart(); }

    // Efficient render: batches DOM updates
    function renderProducts(list){
      productGrid.innerHTML = '';
      const frag = document.createDocumentFragment();
      list.forEach(p=>{
        const el = document.createElement('article');
        el.className = 'product';
        el.innerHTML = `
          <img loading="lazy" src="${p.image}" alt="${p.name}">
          <h3>${p.name}</h3>
          <div class="meta">${p.category} • $${p.price}</div>
          <div class="row">
            <button class="btn view" data-id="${p.id}">View</button>
            <button class="btn secondary add" data-id="${p.id}">Add</button>
          </div>`;
        frag.appendChild(el);
      });
      productGrid.appendChild(frag);
    }

    // Apply filters/search/sort
    function getFiltered(){
      let list = PRODUCTS.slice();
      const cat = categorySel.value;
      const q = searchInput.value.trim().toLowerCase();
      const sort = sortSel.value;
      if(cat !== 'all') list = list.filter(p=>p.category===cat);
      if(q) list = list.filter(p=>p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q));
      if(sort==='low') list.sort((a,b)=>a.price-b.price);
      if(sort==='high') list.sort((a,b)=>b.price-a.price);
      return list;
    }

    // Cart operations
    function addToCart(id, qty=1){
      const prod = PRODUCTS.find(p=>p.id==id);
      if(!prod) return;
      const cart = loadCart();
      const found = cart.find(i=>i.id==id);
      if(found) found.qty += qty; else cart.push({id:prod.id,name:prod.name,price:prod.price,qty});
      saveCart(cart);
      showToast(`${prod.name} added`);
    }
    function removeFromCart(index){
      const cart = loadCart(); cart.splice(index,1); saveCart(cart);
    }
    function changeQty(index, delta){
      const cart = loadCart(); cart[index].qty = Math.max(1, cart[index].qty + delta); saveCart(cart);
    }

    // Render cart drawer
    function renderCart(){
      const cart = loadCart();
      cartList.innerHTML = ''; let total = 0; let count = 0;
      const frag = document.createDocumentFragment();
      cart.forEach((item, idx)=>{
        total += item.price * item.qty; count += item.qty;
        const li = document.createElement('li'); li.className='cart-item';
        li.innerHTML = `
          <img src="https://picsum.photos/seed/cart${item.id}/120/90" alt="${item.name}">
          <div style="flex:1">
            <div style="font-weight:600">${item.name}</div>
            <div class="muted">$${item.price} • Qty: <span data-idx="${idx}" class="qty">${item.qty}</span></div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button data-idx="${idx}" class="btn inc">+</button>
            <button data-idx="${idx}" class="btn secondary dec">-</button>
            <button data-idx="${idx}" class="btn" style="background:#ff5c5c">Remove</button>
          </div>`;
        frag.appendChild(li);
      });
      cartList.appendChild(frag);
      cartTotal.textContent = `Total: $${total.toFixed(2)}`;
      cartCount.textContent = count;
    }

    // Simple toast
    function showToast(msg){
      const t = document.createElement('div'); t.textContent = msg; t.style.cssText='position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#111;color:#fff;padding:8px 12px;border-radius:8px;';
      document.body.appendChild(t); setTimeout(()=>t.remove(),1500);
    }

    // Modal quick view
    let activeProductId = null;
    function openModal(id){
      const p = PRODUCTS.find(x=>x.id==id); if(!p) return;
      activeProductId = id;
      modalImg.src = p.image; modalImg.alt = p.name; modalTitle.textContent = p.name; modalDesc.textContent = p.desc; modalPrice.textContent = `$${p.price}`;
      modalBackdrop.classList.add('open'); modalBackdrop.setAttribute('aria-hidden','false');
      modalAdd.focus();
    }
    function closeModal(){ modalBackdrop.classList.remove('open'); modalBackdrop.setAttribute('aria-hidden','true'); activeProductId=null; }

    // Event delegation: product buttons
    productGrid.addEventListener('click', e=>{
      const view = e.target.closest('.view');
      const add = e.target.closest('.add');
      if(view){ openModal(view.dataset.id); }
      if(add){ addToCart(add.dataset.id); }
    });

    // Cart button handlers (delegated)
    cartList.addEventListener('click', e=>{
      const inc = e.target.closest('.inc');
      const dec = e.target.closest('.dec');
      const rem = e.target.closest('button[style]'); // remove has inline style
      if(inc){ changeQty(Number(inc.dataset.idx), 1); }
      else if(dec){ changeQty(Number(dec.dataset.idx), -1); }
      else if(rem){ removeFromCart(Number(rem.dataset.idx)); }
    });

    // Controls
    [categorySel, sortSel].forEach(el=>el.addEventListener('change', ()=>renderProducts(getFiltered())));
    searchInput.addEventListener('input', ()=>{ /* debounce for perf */ clearTimeout(searchInput._t); searchInput._t = setTimeout(()=>renderProducts(getFiltered()),120); });

    // Cart drawer open/close
    openCartBtn.addEventListener('click', ()=>{ const open = cartDrawer.classList.toggle('open'); openCartBtn.setAttribute('aria-expanded', String(open)); renderCart(); });
    clearCartBtn.addEventListener('click', ()=>{ localStorage.removeItem(CART_KEY); renderCart(); });
    checkoutBtn.addEventListener('click', ()=>{ alert('Mock checkout — replace with real flow.'); localStorage.removeItem(CART_KEY); renderCart(); });

    // Modal buttons
    modalBackdrop.addEventListener('click', e=>{ if(e.target===modalBackdrop) closeModal(); });
    modalClose.addEventListener('click', closeModal);
    modalAdd.addEventListener('click', ()=>{ if(activeProductId) addToCart(activeProductId); closeModal(); });

    // Initial render
    renderProducts(getFiltered()); renderCart();

    // Accessibility: close modal with Esc
    document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ closeModal(); } });

    // Optional: register a very small service worker if available (caching static assets). In real deploy use separate file.
    if('serviceWorker' in navigator){ try{ navigator.serviceWorker.register('/service-worker.js').catch(()=>{}); }catch(e){}
    }

    // Expose for debugging (dev only)
    window.__SHOPLY = { PRODUCTS, loadCart, saveCart, addToCart };
  })();
  </script>
</body>
</html>
